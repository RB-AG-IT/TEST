<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Kundenliste</title>
  <style>
    body { font-family: Arial; padding: 20px; max-width: 900px; margin: auto; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 6px; font-size: 14px; }
    th { background: #f3f3f3; }
    a { text-decoration: none; color: #007bff; }
    a.button { display: inline-block; padding: 8px 12px; margin: 5px 5px 15px 0; border: 1px solid #007bff; border-radius: 4px; }
  </style>
</head>
<body>
  <h2>Kundenliste</h2>

  <a class="button" href="index.html">Startseite</a>
  <a class="button" href="kunde-neu.html">Neuen Kunden anlegen</a>

  <table>
    <thead>
      <tr>
        <th>Vorname</th>
        <th>Nachname</th>
        <th>Kunde</th>
        <th>Stadt</th>
        <th>Details</th>
      </tr>
    </thead>
    <tbody id="kundenListe"></tbody>
  </table>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const db = supabase.createClient(
      "https://ipitjuyeplkaywatmnxg.supabase.co",
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlwaXRqdXllcGxrYXl3YXRtbnhnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwNTU3NjEsImV4cCI6MjA3ODYzMTc2MX0.JZ71lI049-_Z0bJvXIyIOoMFNR_Cgg7wLgbuOEsXCec"
    );

    const kundenListe = document.getElementById("kundenListe");

    async function ladeKunden() {
      const { data, error } = await db
        .from("kunden")
        .select("*")
        .order("created_at", { ascending: false });

      if (error) {
        console.error(error);
        alert("Fehler beim Laden der Kunden");
        return;
      }

      kundenListe.innerHTML = "";
      data.forEach(k => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${k.vorname || ""}</td>
          <td>${k.nachname || ""}</td>
          <td>${k.kunde || ""}</td>
          <td>${k.stadt || ""}</td>
          <td><a href="kunde-detail.html?id=${k.id}">Anzeigen</a></td>
        `;
        kundenListe.appendChild(tr);
      });
    }

    ladeKunden();
  </script>
</body>
</html>
