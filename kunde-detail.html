<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Kundendetails</title>
  <style>
    body { font-family: Arial; padding: 20px; max-width: 600px; margin: auto; }
    .feld { margin-bottom: 8px; }
    .label { font-weight: bold; }
    a.button { display: inline-block; padding: 8px 12px; margin: 5px 5px 15px 0; border: 1px solid #007bff; border-radius: 4px; text-decoration: none; }
  </style>
</head>
<body>
  <h2>Kundendetails</h2>

  <a class="button" href="kunden-liste.html">Zurück zur Liste</a>
  <a class="button" href="index.html">Startseite</a>

  <div id="details">Lade Daten...</div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const db = supabase.createClient(
      "https://ipitjuyeplkaywatmnxg.supabase.co",
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlwaXRqdXllcGxrYXl3YXRtbnhnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwNTU3NjEsImV4cCI6MjA3ODYzMTc2MX0.JZ71lI049-_Z0bJvXIyIOoMFNR_Cgg7wLgbuOEsXCec"
    );

    const detailsDiv = document.getElementById("details");
    const params = new URLSearchParams(window.location.search);
    const id = params.get("id");

    if (!id) {
      detailsDiv.textContent = "Keine ID übergeben.";
    } else {
      ladeKunde(id);
    }

    async function ladeKunde(id) {
      const { data, error } = await db
        .from("kunden")
        .select("*")
        .eq("id", id)
        .single();

      if (error || !data) {
        console.error(error);
        detailsDiv.textContent = "Kunde nicht gefunden.";
        return;
      }

      const k = data;

      detailsDiv.innerHTML = `
        <div class="feld"><span class="label">Vorname:</span> ${k.vorname || ""}</div>
        <div class="feld"><span class="label">Nachname:</span> ${k.nachname || ""}</div>
        <div class="feld"><span class="label">E-Mail:</span> ${k.email || ""}</div>
        <div class="feld"><span class="label">Telefon:</span> ${k.telefon || ""}</div>
        <div class="feld"><span class="label">Kunde / Firma:</span> ${k.kunde || ""}</div>
        <div class="feld"><span class="label">Straße:</span> ${k.strasse || ""}</div>
        <div class="feld"><span class="label">Stadt:</span> ${k.stadt || ""}</div>
        ${
          k.bild_url
            ? `<div class="feld"><span class="label">Bild:</span><br>
                 <img src="${k.bild_url}" alt="Kundenbild" style="max-width:200px; max-height:200px; object-fit:cover;">
               </div>`
            : ""
        }
        <div class="feld"><span class="label">Bemerkung:</span><br>${k.bemerkung || ""}</div>
      `;
    }
  </script>
</body>
</html>
